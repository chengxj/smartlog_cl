<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="app">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>首页</title>
<link href="/resources/css/shouye.css" rel="stylesheet" type="text/css" />
<link href="/resources/css/finish.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/resources/js/angular.min.js"></script>
<script type="text/javascript" src="/resources/js/angular-resource.min.js"></script>
<script type="text/javascript" src="/resources/js/angular-common-0.4.min.js"></script>
</head>
<body ng-controller="controller">
    <div class="logo"><div class="logo_sub1">
	    	<img class="logo_sub2" src="/resources/images/logo.png" />
        </div></div>
    <div class="head">
        <div class="nav">
            <div class="nav1_sub1"><span>1 用户名</span></div>
            <div class="nav1"><span>2 单机管理</span></div>
            <div class="nav1"><span>3 告警内容</span></div>
            <div class="nav2"><span>4 安装</span></div>
            <div class="nav_bg"></div>

        </div>
    </div>
    <div class="main">
        <div class="mount">安装</div>
        <div class="schedule">
            <div class="schedule_1" ng-cloak>正在安装{[{getCurrentComponent(single.components)}]}组件，{[{single.ip}]}......</div>
            <div class="schedule_2" ng-cloak>
                <div class="schedule_2_1" ng-style="process"></div>
            </div>
        </div>
        <div class="classify">
            <div class="kind" ng-cloak>
                <div ng-class="getStyle(item.status, item.current_status)" ng-repeat="item in single.components">{[{item.showname}]}</div>
            </div>
        </div>
        <div class="center">
            <div class="center_1 gd_line">
                <p class="text_hui">2015-10-16 16:57:00,621 [myid:0] - INFO  [QuorumPeer[myid=0]/0:0:0:0:0:0:0:0:2181:FileTxnSnapLog@240] - Snapshotting: 0x0 to /ultrapower/data/zookeeperersion-2/snapshot.0</p>
                <p class="text_hui">2015-10-16 16:57:01,078 [myid:0] - INFO  [/192.168.120.122:3888:QuorumCnxManager$Listener@511] - Received connection request /192.168.120.123:50481</p>
                <p class="text_hui">2015-10-16 16:57:01,087 [myid:0] - INFO  [WorkerReceiver[myid=0]:FastLeaderElection@597] - Notification: 1 (message format version), 1 (n.leader), 0x0 (n.zxid), 0x1 (n.round), LOOKING (n.state), 1 (n.sid), 0x0 (n.peerEpoch) FOLLOWING (my state)</p>
                <p class="text_red">2015-10-16 16:57:01,092 [myid:0] - INFO  [WorkerReceiver[myid=0]:FastLeaderElection@597] - Notification: 1 (message format version), 2 (n.leader), 0x0 (n.zxid), 0x1 (n.round), LOOKING (n.state), 1 (n.sid), 0x0 (n.peerEpoch) FOLLOWING (my state)</p>
                <p class="text_hui">2015-10-16 16:57:00,621 [myid:0] - INFO  [QuorumPeer[myid=0]/0:0:0:0:0:0:0:0:2181:FileTxnSnapLog@240] - Snapshotting: 0x0 to /ultrapower/data/zookeeperersion-2/snapshot.0</p>
                <p class="text_hui">2015-10-16 16:57:00,621 [myid:0] - INFO  [QuorumPeer[myid=0]/0:0:0:0:0:0:0:0:2181:FileTxnSnapLog@240] - Snapshotting: 0x0 to /ultrapower/data/zookeeperersion-2/snapshot.0</p>
                <p class="text_hui">2015-10-16 16:57:00,621 [myid:0] - INFO  [QuorumPeer[myid=0]/0:0:0:0:0:0:0:0:2181:FileTxnSnapLog@240] - Snapshotting: 0x0 to /ultrapower/data/zookeeperersion-2/snapshot.0</p>
            </div>
        </div>
        <div class="finish">
            <div class="finish_1"><div class="finish_2">完成</div></div>
        </div>
    </div>
    <div  id="footer"><div class="fanxiang">Copyright 2015-2020  神州泰岳 版权所有</div></div>
<script>
var id = {{id}};

angular.module('app', ['common'])
.config(function($interpolateProvider) {
  $interpolateProvider.startSymbol('{[{');
  $interpolateProvider.endSymbol('}]}');
})
.controller('controller', ['$scope', 'commonDao', 'commonUtil', '$interval',
    function($scope, commonDao, commonUtil, $interval) {

      $scope.getStyle = function(status, current_status) {
        var style = "breed_green";
        if(status<0){
          if(current_status) {
            style = "breed box-shadow-blue";
          } else {
            style = "breed box-shadow-hui";
          }
        } else if (status>0) {
          style = "breed_red";
          if(current_status) {
            style += " box-shadow-blue";
          }
        } else {
          if(current_status) {
            style += " box-shadow-blue";
          }
        }
        return style;
      };

      $scope.getCurrentComponent = function(components) {
        var currentComponent = "";
        if(components!=null&&components.length>0) {
          for (var i=0;i<components.length;i++) {
            var temp = components[i];
            if (temp.current_status==true) {
              currentComponent = temp.showname;
              break;
            }
          }
        }
        return currentComponent;
      };


      $scope.process = {"width":"0%","transition":"width 1s"};

      $interval(function() {
        commonDao.getSingleServerFinish().save({'id':id}, function(data) {
          $scope.single = data;
          $scope.process = {"width":$scope.getProcess() + "%","transition":"width 1s"};
        });
      }, 15000);

      $scope.getProcess = function() {
        var process = 0;
        if ($scope.single.components!=null&&$scope.single.components.length>0) {
          for(var i=0;i<$scope.single.components.length;i++) {
            if($scope.single.components[i].status>=0) {
              process += 1;
            }
          }
        }
        return (process*100/$scope.single.components.length).toFixed(2);
      };

      commonDao.getSingleServerFinish().save({'id':id}, function(data) {
        $scope.single = data;
        $scope.process = {"width":$scope.getProcess() + "%","transition":"width 1s"};
      });
}]);
</script>
</body>
</html>
